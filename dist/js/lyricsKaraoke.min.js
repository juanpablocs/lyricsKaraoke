RegExp.prototype.execAll=function(e){for(var r=null,n=[];r=this.exec(e);){var p=[];for(i in r)parseInt(i)==i&&p.push(r[i]);n.push(p)}return n};
var audio,jpKaraoke,karaoke;jpKaraoke=function(){function e(){}var t,a,r,o,i,n;return n=1,r=/\[(\d{1,2}:[\d.]+)\]([^\[]+)?/g,o=/^\[(\d*)\:(.*)\]/i,a=[],t={},i=4,e.prototype.str={cntKaraoke:"#karaoke",lineKaraoke:"#karaoke li p",cntKaraokeLyric:"#karaokeText",itemKaraoke:".karaoke",itemKaraokePos:function(e){return".karaoke_"+e}},e.prototype._tmp={cntHeight:0,lineHeight:0},e.prototype.catchDom=function(){var e;e=this,t.cntKaraoke=$(e.str.cntKaraoke),t.lineKaraoke=$(e.str.lineKaraoke),t.cntKaraokeLyric=$(e.str.cntKaraokeLyric)},e.prototype.ready=function(){this.createTimeLine(),this.bindHtmlViewKaraoke(),this.bindStyleHtml(),console.log("ready")},e.prototype.bindStyleHtml=function(){var e;e=this,e.catchDom(),e._tmp.lineHeight=t.lineKaraoke.outerHeight(),e._tmp.cntHeight=e._tmp.lineHeight*i,t.cntKaraoke.animate({height:e._tmp.cntHeight+"px"},500)},e.prototype.bindHtmlViewKaraoke=function(){var e,r;e=this,r=[],a.length>0&&($.each(a,function(t,a){var o;console.log(a),o=""===a.text?"":"<p>"+a.text+"</p>",r.push("<li class='"+e.str.itemKaraoke.replace(".","")+" "+e.str.itemKaraokePos(t).replace(".","")+"'>"+o+"</li>")}),t.cntKaraoke.html(r.join("")))},e.prototype.controlKaraoke=function(e){var r,o,i,n,c,p;for(p=this,c=0,o=0,r=p._tmp.cntHeight/2,n=p._tmp.lineHeight/2,e+=500;o<a.length&&a[o].time<e;)c=o,o++;i=$(p.str.itemKaraokePos(c)),$(p.str.itemKaraoke).removeClass("active"),i.addClass("active"),t.cntKaraoke.stop(!0),t.cntKaraoke.scrollTo(i,500,{offset:-r+(n-10),queue:!1})},e.prototype.createTimeLine=function(){var e,a,r,o;for(o=this,o.catchDom(),r=t.cntKaraokeLyric.text(),a=r.split(/\n/g),e=0;e<a.length;)o.fn.timeLine(a[e]),e++},e.prototype.fn={timeLine:function(e){var t,o,i,n,c,p;if(c=this,n=r.execAll(e.trim()),n.length>0)for(o=0,p="";o<n.length;)t=n[n.length-(o+1)],"undefined"!=typeof t[2]&&(p=t[2]),i="undefined"==typeof t[2]?p:t[2],a.push({time:c.fn.parseTimeLrc(t[1]),time_parsed:t[1],text:i}),o++,a.sort(function(e,t){return e.time>t.time?1:e.time<t.time?-1:0})},parseTimeLrc:function(e){var t,a;return a=e.match(o),t=a?60*parseInt(a[1])+parseInt(a[2]):0}},e}(),karaoke=new jpKaraoke,karaoke.ready(),audio=new Audio("https://www.dropbox.com/s/yn3j0rduzho3uvj/bruno_mars_2.mp3?dl=1"),audio.addEventListener("timeupdate",function(e){var t;t=1e3*e.target.currentTime,karaoke.controlKaraoke(t)}),audio.play();